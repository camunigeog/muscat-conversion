# These tests are ran against the generated MARC output

# Format is:
#  
# Number (manually-assigned, so that they can be referenced elsewhere in code)
# Description
# Record number
# MARC field
# Pattern (either simple string or regexp starting with slash delimeter)


1
Basic test
1000
001
/^SPRI-[0-9]{4}$/

2
Ensure that the data has been fully-loaded - this specifies a record very near the end
215073
001
SPRI-215073

3
Ensure *lpt parsing
8690
245
ch = Register

4
FIXME: 500 should not have :,
5472
500
1882-83 : die

5
Use of " as a pseudo- word boundary character, so that "<em>...</em>" gets protected rather than result in e-dot; see: /reports/transliterateem/
8690
245
parokhoda "Andrey Pervozvannyy" v

6
FIXME: Roman numerals followed by hyphen should not be transliterated
206607
880
XVII-

7
FIXME: Roman numerals followed by hyphen should not be transliterated
143341
880
XXI-

8
Unescape Muscat escaped asterisks @*
19682
520
(*495)

9
008 position 06-14 continuing serials e.g. 1990-
1036
008
u1964uuuu

10
008 position 06-14 "Undated-"
177897
008
uuuuuuuuu

11
008 position 06-14 "-"
184400
008
uuuuuuuuu

12
008 position 06-14 "1977?-"
57312
008
u1977uuuu

13
008 position 06-14 "1945-73, 1989-"
19832
008
u1945uuuu

14
008 position 06-14 normalise YYYY-YY "1960-61"
1034
008
d19601961

15
008 position 06-14 *ser normalise YYYY "1991"
1052
008
d19911991

16
008 position 06-14 handle absent date "[n.d.]"
1102
008
nuuuuuuuu

17
008 position 06-14 Probable date "[1994]"
1306
008
s1994####

18
008 position 06-14 *art simple date "1915"
11150
008
s1915####

19
008 position 06-14 "1923 (1931 printing)"
12522
008
r19311923

20
008 position 15-17: Place of publication
169741
008
enk

21
008 position 18-20 form=CD-ROM gets ###
2023
008
tma###

22
008 position 18-20 form=Sound cassette gets |||
102409
008
fr#|||

23
008 position 18-20 form=Poster gets nnn
95733
008
xx#nnn

24
008 position 18-20 Videorecording 60 min gets 060
1968
008
060

25
008 position 18-20 Videorecording [? mins] gets |||
78699
008
nz#|||

26
008 position 18-20 diags gets a##
1115
008
a##

27
008 position 18-20 diags and map gets a and b
1144
008
ab#

28
008 position 18-20 Journal *freq=irregular gets # then x (then #)
1027
008
#x#

29
008 position 21 form=Map gets |
101161
008
xx#||||

30
008 position 22 form=Microfiche *doc gets |
1186
008
xx#####|

31
008 position 22 form=Microfiche *art/*j gets b
11291
008
xx##u#|b

32
008 position 23 form=PDF gets s
201908
008
ar#|ss

33
008 positions 24-27 form=Map gets #|##
101161
008
#|##

34
008 positions 24-27 *ser Bibliographies gets |b
1005
008
|b##

35
008 positions 24-27 *local=Offprint gets 2
198459
008
2###

36
008 position 28 *kw example gets o
15998
008
#o0

37
008 position 29 *ks=061.3 gets d
4263
008
d|

38
008 positions 30-31 *doc *form=CD gets ##
167945
008
###|

39
008 positions 30-31 *art/*in *t contains Festschrift gets 1|
13607
008
1|

40
008 position 33 *doc *k=82-1 gets p
1319
008
p#

41
008 position 33 *ser *lang=French gets b
1031
008
#b|

42
008 position 34 *ks=92(08) gets d
2505
008
deng

43
008 position 34 *t starts autobiography gets a
6046
008
aeng

44
008 positions 35-36 *lang; test uses Esperanto (=epo)
29970
008
epo

45
1-y becomes 1-й in Cyrillic
29343
880
Выпуск 1-й.

46
Prevent multiple italic sections being swallowed in transliterated protected string handling
17256
245
Belukha ili beluga

47
In transliteration, ensure mid-word italics get properly tokenised (rather than remaining as <em> and thus e-dot)
91018
245
fazovoĭ p-T-diagrammy

48
Ditto, mid-word
79687
245
tetra-n-butilammon

49
Cyrillic should not contain a ligature in *ag/*n.. (e.g. from transliterating "Int͡skirveli")
29550
880
Инцкирвели

50
Cyrillic should not contain a ligature in *e/*n/*n.. (e.g. from transliterating "Zherebt͡sov")
1844
880
Compiled by И.Л. Жеребцов

51
Cyrillic should not contain a ligature in 880-700 (e.g. from transliterating "Zherebt͡sov")
1844
880
700-03 ‡aЖеребцов, И. Л.,‡ecompiler

52
Ensure 'Anon.' is treated as a transliterated protected string
6451
880
Anon.

53
English-name author should not result in an 880 transliteration
151048
!880
700-04

54
English-name author should not be transliterated (880-245)
151048
880
J.A. Dowdeswell,

55
Dot-e transliteration failure should not occur in 245
151048
245
Michael

56
Relator terms should be in English in records in scope of transliteration
1844
880
editor.

57
880 490 $v for Russian records having *ts with a *vno should not be transliterated (pending further discussion)
136356
880
/490-03 .+‡vChast 2/

58
880 260 for Russian records now has $b transliteration enabled
6996
880
‡bПросвящение

59
The first *art/*ag/*a field should map to the 1XX field
7195
100
Lecointe, Georges

60
Any further *art/*ag/*a fields should map to 7XX fields
8249
700
Maslov, A. L.

61
Any *art/*ag/*al fields should map to 7XX fields
1963
700
Davies, 'Taff' Gwion

62
Any *art/*e/*n fields should map to 7XX fields
5126
700
Wild, J. J.

63
Note handling
9189
876
the bird

64
Any *art/*in/*ag/*a fields should NOT map to a 1XX or 7XX field
1902
!1**
Filip

65
Any *art/*in/*ag/*al fields should NOT map to a 7XX field
3427
!7**
Karol Edmond





