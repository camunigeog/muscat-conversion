# These tests are ran against the generated MARC output

# Format is:
#  
# Number (manually-assigned, so that they can be referenced elsewhere in code)
# Description
# Record number
# MARC field
# Pattern (either simple string or regexp starting with slash delimeter)

# Coverage level:
# generateAuthors: 100%
# generate008: 100%


1
Basic test
1000
001
/^SPRI-[0-9]{4}$/

2
Ensure that the data has been fully-loaded - this specifies a record very near the end
215073
001
SPRI-215073

3
Ensure *lpt parsing
8690
245
ch = Register

4
FIXME: 500 should not have :,
5472
500
1882-83 : die

5
Use of " as a pseudo- word boundary character, so that "<em>...</em>" gets protected rather than result in e-dot; see: /reports/transliterateem/
8690
245
parokhoda "Andrey Pervozvannyy" v

6
FIXME: Roman numerals followed by hyphen should not be transliterated
206607
880
XVII-

7
FIXME: Roman numerals followed by hyphen should not be transliterated
143341
880
XXI-

8
Unescape Muscat escaped asterisks @*
19682
520
(*495)

9
008 position 06-14 continuing serials e.g. 1990-
1036
008
u1964uuuu

10
008 position 06-14 "Undated-"
177897
008
uuuuuuuuu

11
008 position 06-14 "-"
184400
008
uuuuuuuuu

12
008 position 06-14 "1977?-"
57312
008
u1977uuuu

13
008 position 06-14 "1945-73, 1989-"
19832
008
u1945uuuu

14
008 position 06-14 normalise YYYY-YY "1960-61"
1034
008
d19601961

15
008 position 06-14 *ser normalise YYYY "1991"
1052
008
d19911991

16
008 position 06-14 handle absent date "[n.d.]"
1102
008
nuuuuuuuu

17
008 position 06-14 Probable date "[1994]"
1306
008
s1994####

18
008 position 06-14 *art simple date "1915"
11150
008
s1915####

19
008 position 06-14 "1923 (1931 printing)"
12522
008
r19311923

20
008 position 15-17: Place of publication
169741
008
enk

21
008 position 18-20 form=CD-ROM gets ###
2023
008
tma###

22
008 position 18-20 form=Sound cassette gets |||
102409
008
fr#|||

23
008 position 18-20 form=Poster gets nnn
95733
008
xx#nnn

24
008 position 18-20 Videorecording 60 min gets 060
1968
008
060

25
008 position 18-20 Videorecording [? mins] gets |||
78699
008
nz#|||

26
008 position 18-20 diags gets a##
1115
008
a##

27
008 position 18-20 diags and map gets a and b
1144
008
ab#

28
008 position 18-20 Journal *freq=irregular gets # then x (then #)
1027
008
#x#

29
008 position 21 form=Map gets |
101161
008
xx#||||

30
008 position 22 form=Microfiche *doc gets |
1186
008
xx#####|

31
008 position 22 form=Microfiche *art/*j gets b
11291
008
xx##u#|b

32
008 position 23 form=PDF gets s
201908
008
ar#|ss

33
008 positions 24-27 form=Map gets #|##
101161
008
#|##

34
008 positions 24-27 *ser Bibliographies gets |b
1005
008
|b##

35
008 positions 24-27 *local=Offprint gets 2
198459
008
2###

36
008 position 28 *kw example gets o
15998
008
#o0

37
008 position 29 *ks=061.3 gets d
4263
008
d|

38
008 positions 30-31 *doc *form=CD gets ##
167945
008
###|

39
008 positions 30-31 *art/*in *t contains Festschrift gets 1|
13607
008
1|

40
008 position 33 *doc *k=82-1 gets p
1319
008
p#

41
008 position 33 *ser *lang=French gets b
1031
008
#b|

42
008 position 34 *ks=92(08) gets d
2505
008
deng

43
008 position 34 *t starts autobiography gets a
6046
008
aeng

44
008 positions 35-36 *lang; test uses Esperanto (=epo)
29970
008
epo

45
1-y becomes 1-й in Cyrillic
29343
880
Выпуск 1-й.

46
Prevent multiple italic sections being swallowed in transliterated protected string handling
17256
245
Belukha ili beluga

47
In transliteration, ensure mid-word italics get properly tokenised (rather than remaining as <em> and thus e-dot)
91018
245
fazovoĭ p-T-diagrammy

48
Ditto, mid-word
79687
245
tetra-n-butilammon

49
Cyrillic should not contain a ligature in *ag/*n.. (e.g. from transliterating "Int͡skirveli")
29550
880
Инцкирвели

50
Cyrillic should not contain a ligature in *e/*n/*n.. (e.g. from transliterating "Zherebt͡sov")
1844
880
Compiled by И.Л. Жеребцов

51
Cyrillic should not contain a ligature in 880-700 (e.g. from transliterating "Zherebt͡sov")
1844
880
700-03 ‡aЖеребцов, И. Л.,‡ecompiler

52
Ensure 'Anon.' is treated as a transliterated protected string
6451
880
Anon.

53
English-name author should not result in an 880 transliteration
151048
!880
700-04

54
English-name author should not be transliterated (880-245)
151048
880
J.A. Dowdeswell,

55
Dot-e transliteration failure should not occur in 245
151048
245
Michael

56
Relator terms should be in English in records in scope of transliteration
1844
880
editor.

57
880 490 ‡v for Russian records having *ts with a *vno should not be transliterated (pending further discussion)
136356
880
/490-03 .+‡vChast 2/

58
880 260 for Russian records now has ‡b transliteration enabled
6996
880
‡bПросвящение

59
The first *art/*ag/*a field should map to the 1XX field
7195
100
Lecointe, Georges

60
Any further *art/*ag/*a fields should map to 7XX fields
8249
700
Maslov, A. L.

61
Any *art/*ag/*al fields should map to 7XX fields
1963
700
Davies, 'Taff' Gwion

62
Any *art/*e/*n fields should map to 7XX fields
5126
700
Wild, J. J.

63
Note handling
9189
876
the bird

64
Any *art/*in/*ag/*a fields should NOT map to a 1XX or 7XX field
1902
!1**
Filip

65
Any *art/*in/*ag/*al fields should NOT map to a 7XX field
3427
!7**
Karol Edmond

66
Record has multiple languages
1220
041
‡anor‡aeng‡ager

67
No 100 generated for *ser
1062
!100
*

68
1xx generated for *doc/*ag/*a
1392
110
International Arctic Science Committee

69
1xx generated for *art/*ag/*a (see also next test)
4179
100
Campsterianus

70
1xx not generated for *art/*in/*ag/*a (see also previous test)
4179
!100
Jones

71
1xx generated for *art/*ag/*a in a record having *art/*j
1109
100
Ward

72
Ensure the 100 line ends with punctuation; this example is bracket
1218
100
/\)$/

73
Ensure the 100 line ends with punctuation; this example is dot
1221
700
/\.$/

74
Second author appears as 700, not 100 (see also next test)
7457
!100
Andersson

75
Second author appears as 700, not 100 (see also previous test)
7457
700
Andersson

76
Author in analytic child is pulled into parent (here parent record 7463 and child 9375 which has author Heurck)
7463
700
Heurck

77
Title in analytic child is pulled into parent (here parent record 7463 and child 9375)
7463
700
‡aHeurck, H. van.‡tBotanique: diatomées.

78
Analytic has second indicator set to 2 for 700
7463
i700
12

79
Author in analytic child is pulled into parent (here parent record 7463 and child 7569 which has corporate author)
7463
710
Expédition Antarctique Belge

80
Corporate author
7569
110
Expédition Antarctique Belge

81
Ensure the 7xx line ends with punctuation; this example is bracket (similar to test #72)
7463
700
/et conclusions.$/

82
Ensure the 7xx line ends with punctuation; this example is dot (similar to test #73)
7463
700
/Gamasidae\)$/

83
700: Subfield g must be preceded by a full stop, question mark or exclamation mark
2787
700
.‡g(alternative name)

84
If the author is also a *e illustrator (for example), do not create a second entry (700) as well as the 100
147053
!700
Debenham, Frank

85
Each *e/*n, *role, with Relator Term lookup substitution, results in 700
47079
700
Michael, Henry N.,‡eeditor.

86
An *n1 with value 'others' does not result in a 700
8988
!700
others

87
*ke value in parent record is just a GUI indicator, not resulting in MARC data
1221
!700
ME1221

88
Analytic children only have their first author pulled in (e.g. second author of record 7501 ignored)
7463
!700
Stephani

89
700: Subfield ‡t must be preceded by a question mark, full stop, hyphen or closing parenthesis; here testing dot
9843
700
.‡t

90
Authors: subfield ‡u, if present, goes before subfield ‡e
127378
700
, ‡uHUN-FOMI-RSC,‡eeditor.

91
Space out initials for authors (see also next test)
1296
100
J. J.

92
245 does not space out initials for authors (see also previous test)
1296
245
J.J.

93
110 separates *a/*n1 portions before and after dot into ‡a and ‡b (see also next test)
127474
110
‡aCanada.‡b Royal Commission

94
110 does not separate *a/*n1 portions on exceptions list (see also previous test)
124936
110
‡aFrederick A. Cook Society.

95
Spacing out initials should be tolerant of Cyrillic transliteration
175507
700
M. Kh.

96
Spacing out initials should be tolerant of non-ASCII initials
201319
100
Č. M.

97
Spacing out initials should be tolerant of non-ASCII initials, copied into parent 700
44492
700
Č. M.

98
In *nd classification, strip italic tags
45578
100
‡cSir.

99
In *nd classification, handle special-cases which generate a ‡b
165177
100
‡b I,‡cPrince of Monaco.

100
In *ad classification, date appears as ‡d
6575
100
,‡d 1863-1945.

101
In *ad classification, avoid space after comma before ‡d to avoid Bibcheck error "100: Subfield d must be preceded by a comma"
6575
100
,‡d

102
Basic *ad classification check
1165
100
‡etranslator

103
Basic *aff classification check
121449
100
‡uGBR-UMa-SG

104
1xx: If first *ag is actually an editor, mutate to 7xx (see also test #162)
31105
710
‡aJapan Antarctic Survey,‡eeditor.

105
In author handling, allow exact relator terms match (e.g. 'editor')
113955
700
‡eeditor

106
In author handling, support substring match (e.g. 'Translated from the Icelandic by')
1639
700
‡etranslator

107
100 ‡a transliteration results in 880
6653
880
100-01 ‡aБогданович, К. И.

108
700 ‡a transliteration in Russian record results in 880
23186
880
‡aСементовский, В. Н.

109
Ensure correct multiline handling of 880 in authors module
23186
880
‡aНовосильский, П. М.

110
In generate other entities phase of authors, ensure second author in a *ser does not appear
107192
!700
*

111
Ensure field code does not appear twice in generate other entities phase of authors
1127
!700
 700

112
In generate other entities phase of authors, ensure first author does not reappear in a 700 but is in 100 (see also next test)
1127
!700
‡aEvers, Dietrich

113
In generate other entities phase of authors, ensure first author does not reappear in a 700 but is in 100 (see also previous test)
1127
100
‡aEvers, Dietrich

114
In generate other entities phase of authors, ensure second author appears in 700
1127
700
‡aStölting, Siegfried

115
In generate other entities phase of authors, ensure third author appears in 700
1333
700
‡aTyaptirgyanov, M.

116
In generate other entities phase of authors, ensure first *al in *ag appears
1565
700
‡aFaleev, V. I.

117
In generate other entities phase of authors, ensure second *al in *ag appears
29234
700
‡aJaster, Jan

118
Check ‡g(alternative name) appears for such authors
29234
700
‡aChudzikowska, Jadwiga.‡g(alternative name)

119
Check *e (first) becomes 700
1247
700
‡aChilderhose, R. J.

120
Check second *e becomes a 700
2295
700
‡aSonnini, C. S.

121
Relator term ‡e does not have a space before
2295
700
‡aSonnini, C. S.,‡econtributor

122
Multiple relator term ‡e values do not have space between
2295
700
‡econtributor,‡eeditor.

123
Anon handling for 100
1394
100
‡aAnonymous.

124
Single name handling for 100
181460
100
‡aIgnatius.

125
Spacing-out handling in single name handling for 100
213499
100
‡aE. L. H.

126
Surname-only handling for 100
111558
100
‡adi Georgia.

127
Surname-only handling for 100 with entities
3904
100
‡aSöderbergh.

128
Conference handling for n1 in 1xx
50035
111
‡aConference on the Conservation of Antarctic Seals.

129
Conference handling for n1 in 1xx with entities
8728
111
‡aCongrès

130
Conference handling for Russian LoC transliterated values
32818
111
‡aNauchnai͡a konferent͡sii͡a

131
Conference handling for congress (not US Congress) (see also next test)
55763
111
‡aXXIII International Geographical Congress.

132
Conference handling for US Congress (see also previous test)
1912
110
‡aUnited States.‡b Congress.

133
111 ‡a: Simple conference name
173340
111
/‡aArctic Science Conference\.$/

134
111 ‡a: Conference and date
57564
111
‡aSymposium on Antarctic Resources ‡d(1978)

135
111 ‡a: Conference, date and location
32965
111
‡aConference on Antarctica ‡d(1959 :‡cWashington, D.C.)

136
111 ‡a: Conference, number, date and location
51434
111
‡aInternational Conference on Permafrost ‡n(2nd :‡d1973 :‡cYakutsk, Siberia, U.S.S.R)

137
111 ‡a: Conferences with commas not intended as delimeters
55264
111
‡aConference on Soil-Water Problems in Cold Regions ‡n(2nd :‡d1976 :‡cEdmonton, Alberta)

138
1xx *n2 basic handling
1296
100
‡aStansfield, J. J.

139
1xx *n2 fuller form of name
170179
700
‡aIrons, David B. ‡q(David Bruce)

140
1xx *n2 fuller form of name with entities
4366
100
‡aFaye, H. ‡q(Hervé)

141
Check for *a not containing a *nd (see also next test)
1105
100
/‡aOrvik, James M.$/

142
Check for *a containing a *nd (see also previous test)
1201
100
,‡cSir.

143
1xx *nd prefix with entities
53959
100
,‡cCapitán.

144
1xx *nd suffix
23362
100
,‡c2nd Baron Tweedsmuir.

145
1xx *nd between *n1 and *n2
3180
700
,‡cFreiherr von

146
Basic relator term handling
181142
710
,‡eeditor.

147
Basic relator term handling with entities
10004
700
,‡eeditor.

148
*nd misc list handling in 1xx; also: has space after ‡g
1218
100
‡g (Campsterianus)

149
*ad affiliation list handling in 1xx (partial string)
165077
100
‡uZoological Museum at Berlin

150
*ad affiliation list handling in 1xx (complete string match)
19171
100
, ‡uO.M.I.

151
*ad affiliation with ‡c and ‡u
18045
100
,‡cRev.,‡uO.M.I.

152
Relator term handling with //ONLY flag (exact match)
122529
700
,‡econtributor.

153
Relator term handling with //ONLY flag (partial match)
1253
700
,‡eillustrator.

154
Relator term handling with //NOT flag (positive match)
44786
700
,‡eeditor.

155
Relator term handling with //NOT flag (negative match)
24674
!700
‡eeditor

156
Relator term handling with //REQUIRES flag (positive match)
139689
700
‡enarrator

157
Relator term handling with //REQUIRES flag (negative match)
101462
!700
‡enarrator

158
7xx *e/*n relator terms support
147053
700
,‡eillustrator.

159
Test *e/*role handling when *n1 = 'the author'
147053
700
,‡eillustrator.

160
100 Ensure dot at end when not naturally present
46177
100
/\.$/

161
100 Ensure single dot at end when already naturally present
46175
100
/L\.$/

162
1xx: If first *ag is actually an compiler, mutate to 7xx (see also test #104)
4012
700
‡aTravis, George,‡ecompiler.

163
245 uses main title when *in exists
1104
245
‡aGlen Prosen and the memory of an Antarctic tragedy

164
245 "and 4 others" does not get transliterated in 880
210651
880
‡cА.М. Никанаров, and 4 others.

165
245 880 gets transliteration in Russian records
210651
880
‡aАнтропогенная нагрузка на устья рек Российской Арктики

166
245 first indicator set to 1 when 100 present
210651
i245
/^1./

167
245 first indicator set to 1 when other 1xx present
1102
i245
/^1./

168
245 first indicator set to 1 when 100 not present
1134
i245
/^0./

169
245 second indicator set to 4 with leading article 'the'
1110
i245
/^.4/

170
245 second indicator set to 0 with no leading article
1134
i245
/^.0/

171
245 second indicator set to 3 leading article 'Ei' in Norwegian record
103693
i245
/^.3/

172
245 *t colon handling splits to ‡a: ‡b
1119
245
‡aThe issue is survival :‡ba summary

173
245 *t with colon and record having *form results in ‡h; "it follows the title proper" "and precedes the remainder of the title"
12359
245
North‡h[videorecording] :‡ba story

174
245 *t without colon results in ‡a
1000
245
‡aAdmiralty List of Lights.

175
245 *t without colon but having *form results in ‡h after ‡a
1186
245
microorganisms‡h[Microfiche]

176
245 ‡h appears in 880 for Russian records
9543
880
Известия‡h[Microfiche].

177
245 *ser with *t already having dot ends with single dot
137684
245
/Review\.$/

178
245 *ser with *t ending with ) gets additional . at end
1058
245
/\)\.$/

179
*ser gets no Statement of Responsibility in 245
1058
!245
‡c

180
Basic Statement of Responsibility existence test
1159
245
 /‡cJoëlle Robert-Lamblin.

181
245 *doc Statement of Responsibility starts with first *doc/*ag/*a
1121
245
‡cNunam Kitlutsisti

182
245 *doc Statement of Responsibility continues with second *doc/*ag/*a
1121
245
‡cNunam Kitlutsisti, Mary Lenz

183
245 *art Statement of Responsibility starts with first *art/*ag/*a
1135
245
‡cR.R. Makarov

184
245 *art Statement of Responsibility continues with second *art/*ag/*a
1135
245
‡cR.R. Makarov, C.J. Denys

185
245 *art Statement of Responsibility continues with as many authors as present
181939
245
‡cP.J. Barrett, L. Carter, D. Damiani, G.B. Dunbar, E. Dunker, G. Giorgetti, M.A. Harper, R.M. McKay, F. Niessen, U. Nixdorf, A.R. Pyne, C. Riesselmann, N. Robinson, C. Hollis, P. Strong.

186
245 *art Statement of Responsibility multiple authors separated by comma-space
1135
245
Makarov, C.J.

187
245 *art Statement of Responsibility multiple author groups separated by space-semicolon-space
134805
245
H. Maitre ; F.

188
245 *art Statement of Responsibility multiple author groups with second author in second group
133876
245
‡cJ. Walden ; J.P. Smith, R.V. Dackombe ; J. Rose.

189
245 *art Statement of Responsibility does not show *aff value
133876
!245
GBR-UO-SG

190
245 *art Statement of Responsibility punctuation when 'and 5 others'
131672
245
Cortijo ; and 5 others.

191
245 Statement of Responsibility handling of *ad
149106
245
‡cA.R. Artemʹev, ed.

192
245 Statement of Responsibility handling of multiple *ad in an *ag
162152
245
‡cV.A. Aleksandrov, and 11 others, eds.

193
245 If *ag/*a group is '-' (e.g. due to *n1 = '-' only), skip entry in Statement of Responsibility
178946
!245
‡c

194
245 If *ag/*a group is '-' (e.g. due to *n1 = '-' only), skip entry in Statement of Responsibility (with *ad also present)
115773
!245
‡c

195
245 Add each *e role and siblings
2930
245
‡cÉlie Le Guillou ; Edited by J. Arago.

196
245 No semicolon separator if *e without *ag
145630
245
‡cTranslated by Henry Myers.

197
245 Role and siblings construction
1844
245
Compiled by I.L. Zherebt͡sov.

198
245 Role and siblings construction (multiple *e groups)
2295
245
; Additional work by Leclerc de Buffon ; revised order, notes and additions by C.S. Sonnini.

199
245 Role and siblings construction (two *n groups in *e)
1639
245
; Translated from the Icelandic by Eiríkr Magnússon and William Morris.

200
245 Role and siblings construction (three *n groups in *e, triggering comma-and)
3876
245
drawings by A. Faguet, Mesnel, Emile Bayard and J. Stewart
